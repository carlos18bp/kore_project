# An√°lisis de Requerimientos ‚Äî Kore V2

Radiograf√≠a de la plataforma actual + clasificaci√≥n de requerimientos por fase de desarrollo, con prioridad, dependencias y precondiciones faltantes detectadas.

> **√öltima actualizaci√≥n:** Alcance definitivo acordado con el cliente ‚Äî 23 requerimientos (13 principales + 10 complementarios).

---

## Estado Actual de la Plataforma (V1)

### Lo que existe en el backend hoy
| Modelo / Servicio | Estado |
|---|---|
| `User` (customer/trainer/admin roles) | ‚úÖ Implementado |
| `Package` (personalizado / semi-personalizado / terap√©utico) | ‚úÖ Implementado |
| `TrainerProfile` (specialty, bio, location, session_duration) | ‚úÖ Implementado |
| `Subscription` (active/expired/canceled, recurring billing) | ‚úÖ Implementado |
| `AvailabilitySlot` (slots por trainer, bloqueables) | ‚úÖ Implementado |
| `Booking` (pending/confirmed/canceled, reschedule/cancel 24h) | ‚úÖ Implementado |
| `Payment` + `PaymentIntent` (Wompi: card/Nequi/PSE/Bancolombia) | ‚úÖ Implementado |
| `Notification` (booking/subscription/payment emails) | ‚úÖ Implementado |
| `ics_generator.py` (adjunto .ics para calendario) | ‚úÖ Implementado |
| Tareas peri√≥dicas Huey (billing recurrente + recordatorio expiraci√≥n) | ‚úÖ Implementado |
| reCAPTCHA en login/registro | ‚úÖ Implementado |
| Pre-registro (token firmado ‚Üí checkout ‚Üí creaci√≥n de usuario) | ‚úÖ Implementado |

### Flujos del usuario hoy (roles: guest / user)
- **Guest**: Home, Programas, FAQ, Contacto, Kore Brand, T√©rminos, Registro, Login, Checkout (4 m√©todos de pago)
- **User**: Dashboard, Agendar sesi√≥n (calendario + slots), Mis Programas (lista + detalle + historial), Suscripci√≥n (historial de pagos), Reprogramar, Cancelar, Logout

---

## üõ†Ô∏è Secci√≥n 1 ‚Äî Alcance Actual (Fuera del Core, En Desarrollo)

*Funcionalidades que ya tienen base en el c√≥digo pero no est√°n completamente expuestas al usuario final.*

| Requerimiento | Estado en C√≥digo | Qu√© Falta |
|---|---|---|
| **Sistema de Suscripciones** (pausar / cancelar / renovar) | `Subscription.is_recurring`, `process_recurring_billing()` en `tasks.py` | UI de pausar y cancelar desde `/subscription`; bot√≥n "Renovar" para usuarios con Nequi, Bancolombia o PSE (m√©todos no-tarjeta sin billing autom√°tico) |
| **M√≥dulo "Mis Sesiones"** (reprogramaci√≥n y cancelaci√≥n) | `BookingViewSet.cancel()` y `reschedule()`, flows E2E cubiertos | ‚úÖ Completo ‚Äî expuesto en frontend |
| **ReCAPTCHA** | `captcha_views.py`, integrado en login/registro | ‚úÖ Completo |
| **M√≥dulo de Invitados** (base de pre-registro) | Flujo `pre_register` + `registration_token` + checkout guest | Base t√©cnica para el Plan Semi-Personalizado (Secci√≥n 2); sin gesti√≥n post-compra de jerarqu√≠a l√≠der‚Äìinvitado |
| **Adjuntar .ics al confirmar sesi√≥n** | `ics_generator.py` completo, `email_service.py` admite attachments | Conectar el generador al email de confirmaci√≥n de booking para que el adjunto se env√≠e autom√°ticamente |
| **Verificaci√≥n de correo electr√≥nico** | No encontrado en codebase (`Notification.Type` no incluye email verification) | Modelo de token de verificaci√≥n, endpoint de confirmaci√≥n, email template, l√≥gica de cuenta "pendiente de verificar" |

---

## üöÄ Secci√≥n 2 ‚Äî Requerimientos para Versi√≥n 2.0

### Leyenda de Prioridad
- **P1** ‚Äî Bloqueante: otros requerimientos dependen de este.
- **P2** ‚Äî Importante: agrega valor central a V2.
- **P3** ‚Äî Deseable: mejora la experiencia sin ser bloqueante.

---

### üîê Checkout y Pagos

| Requerimiento | Prioridad | Depende De | Precondici√≥n Faltante |
|---|---|---|---|
| **Checkbox de T√©rminos y Condiciones en el pago** | **P1** | ‚Äî | Checkbox "Acepto t√©rminos y condiciones" en el formulario de checkout (la p√°gina de T&C ya existe en V1); validaci√≥n en frontend que bloquea el bot√≥n de pago si no est√° marcado; sin cambios en backend |
| **Plan de regalo** (compra de plan para terceros) | P2 | ‚Äî | Campo `gift_recipient_email` en el flujo de checkout; creaci√≥n de usuario destinatario al aprobar el pago; email de bienvenida con instrucciones; formulario de datos del destinatario en checkout |
| **Selector Multi-programa** (gesti√≥n de varios planes activos) | P2 | ‚Äî | Backend ya soporta m√∫ltiples suscripciones por usuario; falta UX en dashboard para cambiar de programa activo y en booking para elegir con qu√© suscripci√≥n agendar |
| **Inicio de sesi√≥n con Google** | P2 | ‚Äî | `django-allauth` o `social-auth-app-django` en backend; credenciales de Google OAuth en settings; bot√≥n "Continuar con Google" en `/login` y `/register`; l√≥gica de merge de cuenta existente (email ya registrado v√≠a formulario) |

---

### üìã Gesti√≥n de Trainer (Dashboard & Perfil)

| Requerimiento | Prioridad | Depende De | Precondici√≥n Faltante |
|---|---|---|---|
| **Gesti√≥n de m√∫ltiples entrenadores** (registro y asignaci√≥n) | **P1** | ‚Äî | Creaci√≥n de cuenta trainer desde panel admin (admin asigna rol `trainer`); campo `assigned_trainer` o relaci√≥n en `Subscription`/`User` para la asignaci√≥n de clientes; los clientes asignados a un trainer **solo pueden agendar con ese trainer** (filtro en booking) |
| **P√°gina p√∫blica del entrenador** (foto, experiencia, especialidades) | P2 | Gesti√≥n de Entrenadores | Campo `profile_photo` en `TrainerProfile`; endpoint p√∫blico `GET /api/trainers/{id}/`; ruta `/trainer/:id` o secci√≥n en `/programs` con foto, experiencia y especialidades |
| **Dashboard del entrenador** (agenda, sesiones del d√≠a) | **P1** | Gesti√≥n de Entrenadores | Nueva √°rea autenticada para rol `trainer`; route guards en frontend; endpoints `GET /api/trainers/me/schedule/` y `GET /api/trainers/me/today/` |
| **Gesti√≥n de clientes** (lista y ficha por cliente) | P2 | Dashboard del Entrenador | Endpoint `GET /api/trainers/me/clients/`; vista de ficha por cliente con historial de sesiones, diagn√≥stico y progreso |
| **Motor de diagn√≥stico y calculadora de √≠ndices** | **P1** | Gesti√≥n de Clientes | Nuevo modelo `ClientDiagnostic` con campos de evaluaci√≥n f√≠sica; motor de c√°lculo autom√°tico de √≠ndices (% grasa, IMC, ICC, etc.) ‚Äî **f√≥rmulas e √≠ndices pendientes de Germ√°n** (ver Pendientes Bloqueantes); formulario de carga en Dashboard del Entrenador |
| **Seguimiento de progreso ‚Äî 4 formatos** (vista t√©cnica del trainer) | P2 | Motor de Diagn√≥stico | **Germ√°n debe entregar los 4 formatos estandarizados** (ver Pendientes Bloqueantes); modelo `ProgressRecord` adaptado a los 4 formatos; formulario de carga en Dashboard del Entrenador |
| **Confirmaci√≥n de asistencia** (trainer registra si el cliente asisti√≥) | P2 | Dashboard del Entrenador | Campo `attendance_confirmed` en `Booking`; endpoint `POST /api/bookings/{id}/confirm-attendance/`; acci√≥n en Dashboard del Entrenador |
| **Sistema de calificaciones** (cliente y trainer califican cada sesi√≥n) | P2 | Confirmaci√≥n de Asistencia | Nuevo modelo `SessionRating` (campos: `booking`, `rater_role` [customer/trainer], `score` 1‚Äì5, `comment`, `created_at`); endpoint `POST /api/bookings/{id}/rate/`; trigger post-sesi√≥n para solicitar calificaci√≥n a ambos lados |

---

### üë§ Experiencia del Cliente (Perfil & Progreso)

| Requerimiento | Prioridad | Depende De | Precondici√≥n Faltante |
|---|---|---|---|
| **Perfil del cliente con vista de diagn√≥stico** | P2 | Motor de Diagn√≥stico | Campos adicionales en `User` o modelo extendido: `profile_photo`, `address`, `birthdate`, `phone`; endpoint `PATCH /api/auth/me/`; vista `/profile` con secci√≥n de diagn√≥stico m√°s reciente con sem√°foro de salud por √≠ndice (verde/amarillo/rojo) y descripci√≥n en lenguaje amigable |
| **Visualizaci√≥n de progreso** (cliente ve sus 4 formatos en lenguaje amigable) | P2 | Seguimiento de Progreso | Vista `/my-progress` que traduce los datos t√©cnicos del trainer a lenguaje amigable; tracking visual tipo l√≠nea de tiempo o gr√°fica de mejoramiento; el cliente ve evoluci√≥n, no datos t√©cnicos crudos |
| **Plan alimentario** (cliente consulta su dieta asignada) | P2 | Seguimiento de Progreso | Si el plan alimentario es uno de los 4 formatos, comparte el mismo modelo; endpoint `GET /api/progress/my-plan/`; ruta `/my-nutrition` en frontend ‚Äî **estructura pendiente de Germ√°n** (ver Pendientes Bloqueantes) |

---

### üë• Plan Semi-Personalizado ‚Äî Invitados

| Requerimiento | Prioridad | Depende De | Precondici√≥n Faltante |
|---|---|---|---|
| **Plan semi-personalizado con invitados** (titular invita hasta 2 personas) | **P1** | Perfil del Cliente | Post-compra del plan semi-personalizado: secci√≥n en dashboard para ingresar correos de hasta 2 invitados (total 3 personas); env√≠o de email de invitaci√≥n desde Kore Health con link de registro; FK o relaci√≥n `group_leader` en `Subscription` |
| **Cuentas de invitados con perfil completo** | P2 | Plan Semi-Personalizado | Los invitados tienen perfil completo (diagn√≥stico, progreso, calificaciones) pero **no pueden agendar sesiones**; el agendamiento lo gestiona exclusivamente la cuenta principal (l√≠der del grupo) |
| **Sesiones grupales** (la cuenta principal agenda para todos) | P2 | Cuentas de Invitados | Las sesiones cubren a todos los miembros del grupo; modelo `BookingGroup` o campo `group_members` en `Booking`; el trainer ve a todos los participantes de la sesi√≥n |
| **M√≥dulo de invitados base** (invitados fuera del plan semi-personalizado) | P3 | Plan Semi-Personalizado | Gesti√≥n general de invitados independiente del plan semi-personalizado; casos donde el cliente quiere agregar acompa√±antes a cualquier plan; extensi√≥n de la l√≥gica de `group_leader` |

---

### üõí Servicios Complementarios

| Requerimiento | Prioridad | Depende De | Precondici√≥n Faltante |
|---|---|---|---|
| **Servicios complementarios** (add-ons que el entrenador ofrece al cliente) | **P1** | ‚Äî | **Germ√°n debe entregar el cat√°logo de complementarios** (ver Pendientes Bloqueantes); modelo `ComplementaryService` (nombre, descripci√≥n, precio, imagen, categor√≠a); integraci√≥n con el flujo de pago existente (Wompi); vista de cat√°logo dentro de la plataforma para usuarios autenticados |

> üìå **Nota:** El Marketplace P√∫blico (tienda accesible sin cuenta) queda fuera del alcance de V2 por su complejidad. Se planificar√° como **Fase 2 del m√≥dulo de e-commerce** una vez que los Servicios Complementarios est√©n funcionando. Ver secci√≥n al final del documento.

---

### üìÖ Agendamiento y Automatizaci√≥n

| Requerimiento | Prioridad | Depende De | Precondici√≥n Faltante |
|---|---|---|---|
| **Recordatorios de sesi√≥n** (email 24h y 2h antes de la cita) | **P1** | ‚Äî | `Notification.Type.BOOKING_REMINDER` ya existe en el modelo; falta tarea peri√≥dica Huey que busque bookings pr√≥ximos (24h/2h) y env√≠e email; template de email de recordatorio |
| **Horarios din√°micos** (disponibilidad semanal configurable por trainer) | **P1** | Dashboard del Entrenador | Nuevo modelo `WeeklyScheduleTemplate` (d√≠a semana, hora inicio, hora fin) o mejora de `AvailabilitySlot` con recurrencia; UI de gesti√≥n de horarios para trainer; tarea de auto-generaci√≥n de slots |
| **Agendamiento autom√°tico** (sugerencia basada en historial y preferencias) | P3 | Horarios Din√°micos | L√≥gica de sugerencia de pr√≥xima sesi√≥n basada en frecuencia hist√≥rica; formulario de preferencias del usuario (d√≠as, hora preferidos) |

---

## ‚ö†Ô∏è Pendientes Bloqueantes

*Informaci√≥n que debe proporcionar Germ√°n antes de poder dise√±ar o implementar estos m√≥dulos. Fecha l√≠mite sugerida: antes del final del mes 5.*

| Pendiente | Bloquea | Descripci√≥n |
|---|---|---|
| **Lista de √≠ndices y f√≥rmulas de diagn√≥stico** | Motor de Diagn√≥stico + Perfil del Cliente | Lista completa de √≠ndices a calcular (% grasa, IMC, ICC, etc.); campos de entrada por f√≥rmula (peso, talla, circunferencias, etc.); escala de interpretaci√≥n por √≠ndice (rangos saludable / atenci√≥n / riesgo) |
| **Especificaci√≥n de los 4 formatos de seguimiento de progreso** | Seguimiento de Progreso + Visualizaci√≥n del Cliente + Plan Alimentario | Nombre, campos y estructura de cada uno de los 4 formatos estandarizados; cu√°l corresponde al plan alimentario; qu√© datos son t√©cnicos (solo trainer) vs. cu√°les se muestran al cliente |
| **Cat√°logo de servicios complementarios** | Servicios Complementarios | Nombres, descripciones, precios y categor√≠as de cada servicio o producto complementario que se ofrecer√° en la plataforma |

---

## üîÆ Secci√≥n 3 ‚Äî Requerimientos Futuros

*Ideas que expanden la plataforma de forma natural. No forman parte del alcance V2.*

### üí™ Seguimiento F√≠sico Avanzado

| Idea | Descripci√≥n | Por Qu√© Tiene Sentido |
|---|---|---|
| **Diario de Entrenamiento** | El cliente registra sensaciones, esfuerzo percibido y notas despu√©s de cada sesi√≥n. El trainer puede verlas. | Cierra el ciclo de retroalimentaci√≥n entre sesiones sin comunicaci√≥n externa. |
| **Fotos de Progreso** | Subida de fotos (privadas) con vista de comparaci√≥n lado a lado por fecha. | Alto valor percibido para el cliente; diferenciador vs apps gen√©ricas. |
| **Biblioteca de Ejercicios** | El trainer asigna ejercicios con descripci√≥n, video o imagen. El cliente los revisa antes/despu√©s de la sesi√≥n. | Refuerza el aprendizaje y reduce la dependencia exclusiva de las sesiones. |
| **Plan de Entrenamiento Personalizado** | Trainer crea rutinas semanales (d√≠a, ejercicio, series, reps, descanso) asignadas al cliente. | Extensi√≥n natural del diagn√≥stico y el seguimiento de progreso. |

### üë• Social y Comunidad

| Idea | Descripci√≥n | Por Qu√© Tiene Sentido |
|---|---|---|
| **Chat Interno Trainer‚ÄìCliente** | Mensajer√≠a directa dentro de la plataforma, por suscripci√≥n activa. | Elimina la comunicaci√≥n por WhatsApp externo y centraliza el servicio. |
| **Programa de Referidos** | El cliente comparte un link; al completar la compra el referido, ambos obtienen un beneficio. | Adquisici√≥n de nuevos clientes con costo cero; alta tasa de conversi√≥n por confianza social. |
| **Logros y Gamificaci√≥n** | Badges por hitos (primera sesi√≥n, 10 sesiones, 1 mes consecutivo). Rachas de asistencia. | Aumenta la retenci√≥n y motivaci√≥n del cliente en los primeros meses cr√≠ticos. |

### ü§ñ Inteligencia y Automatizaci√≥n

| Idea | Descripci√≥n | Por Qu√© Tiene Sentido |
|---|---|---|
| **Resumen de Progreso Mensual Autom√°tico** | Email/PDF generado al corte del mes con m√©tricas: sesiones asistidas, progreso en medidas, adherencia. | Aporta valor sin que el trainer haga trabajo manual; fideliza al cliente. |
| **Alertas de Inactividad** | Si el cliente no agenda en X d√≠as, notificaci√≥n autom√°tica al trainer y al cliente. | Reduce la tasa de abandono silencioso antes de que el cliente cancele. |
| **Sugerencia de Paquete √ìptimo** | Al renovar, el sistema sugiere el paquete m√°s adecuado basado en el historial de uso. | Aumenta el upselling de forma no agresiva y data-driven. |

### üì± Experiencia Multi-Canal

| Idea | Descripci√≥n | Por Qu√© Tiene Sentido |
|---|---|---|
| **Notificaciones Push Web** | Web push notifications para recordatorios de sesi√≥n, confirmaci√≥n del trainer, mensajes nuevos. | Aumenta el engagement sin requerir app nativa. |
| **Integraci√≥n con Google Calendar / Outlook** | Despu√©s de confirmar una sesi√≥n, agregar directamente a Google Calendar v√≠a OAuth (m√°s all√° del .ics). | Reduce las inasistencias; m√°s conveniente que descargar y abrir un .ics. |
| **App M√≥vil Nativa** | React Native o PWA mejorada para acceso m√≥vil de primera clase. | La audiencia de fitness es predominantemente m√≥vil. |
| **Integraci√≥n con Wearables** | Conexi√≥n con Google Fit / Apple Health para importar datos de actividad y frecuencia card√≠aca. | Complementa el seguimiento del trainer con datos continuos del cliente. |

### üí∞ Comercial y Monetizaci√≥n

| Idea | Descripci√≥n | Por Qu√© Tiene Sentido |
|---|---|---|
| **Marketplace P√∫blico (Fase 2 E-commerce)** | Tienda accesible sin cuenta: carrito para usuarios no registrados, flujo de pago doble, SEO, integraciones con redes sociales. | Ampl√≠a el alcance comercial m√°s all√° de los clientes registrados. Requiere planificaci√≥n independiente. |
| **Paquetes de Sesiones Libres** (sin expiraci√≥n fija) | Paquetes que no caducan en d√≠as sino en n√∫mero de sesiones usadas. | Atractivo para clientes irregulares; reduce la presi√≥n de expiraci√≥n. |
| **Descuentos y Cupones** | C√≥digos promocionales aplicables en checkout. | Campa√±as de reactivaci√≥n, temporadas, primeras compras. |
| **White-label / Multi-tenant** | La plataforma puede ser usada por otros trainers o gyms con su propia marca. | Escalabilidad del negocio m√°s all√° de un solo trainer o centro. |

---

## Dependencias Cr√≠ticas (Resumen Visual)

```
Gesti√≥n de M√∫ltiples Entrenadores (P1)
  ‚îî‚îÄ‚îÄ Dashboard del Entrenador (P1)
        ‚îú‚îÄ‚îÄ Gesti√≥n de Clientes (P2)
        ‚îÇ     ‚îú‚îÄ‚îÄ Motor de Diagn√≥stico + Calculadora (P1) [‚ö†Ô∏è f√≥rmulas pendientes]
        ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ Perfil del Cliente con Diagn√≥stico (P2)
        ‚îÇ     ‚îú‚îÄ‚îÄ Seguimiento de Progreso 4 Formatos (P2) [‚ö†Ô∏è formatos pendientes]
        ‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ Visualizaci√≥n Amigable Cliente (P2)
        ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ Plan Alimentario (P2) [‚ö†Ô∏è estructura pendiente]
        ‚îÇ     ‚îî‚îÄ‚îÄ Sistema de Calificaciones (P2)
        ‚îú‚îÄ‚îÄ Confirmaci√≥n de Asistencia (P2)
        ‚îÇ     ‚îî‚îÄ‚îÄ Sistema de Calificaciones (P2)
        ‚îî‚îÄ‚îÄ Horarios Din√°micos (P1)
              ‚îî‚îÄ‚îÄ Agendamiento Autom√°tico (P3)

Plan Semi-Personalizado con Invitados (P1)
  ‚îî‚îÄ‚îÄ Cuentas de Invitados con Perfil Completo (P2)
        ‚îú‚îÄ‚îÄ Sesiones Grupales ‚Äî titular agenda (P2)
        ‚îî‚îÄ‚îÄ M√≥dulo de Invitados Base ‚Äî general (P3)

Servicios Complementarios (P1) [‚ö†Ô∏è cat√°logo pendiente]

Recordatorios de Sesi√≥n (P1) ‚Üê Notification.Type.BOOKING_REMINDER ya existe
Checkbox T&C en Pago (P1)   ‚Üê solo frontend, independiente, listo para arrancar
Adjuntar .ics (Secci√≥n 1)   ‚Üê solo conectar ics_generator al email de confirmaci√≥n
```

---

## Observaciones T√©cnicas para el Equipo

1. **`TrainerProfile`** ya existe pero le falta `profile_photo`. A√±adir este campo desbloquea la P√°gina P√∫blica del Entrenador.
2. **`Notification.Type.BOOKING_REMINDER`** ya est√° declarado en el modelo pero no tiene tarea Huey asociada ‚Äî es el trabajo pendiente de menor esfuerzo con mayor impacto inmediato (Recordatorios de Sesi√≥n).
3. **`AvailabilitySlot`** tiene `UniqueConstraint(starts_at, ends_at)` global (sin trainer) ‚Äî esto romper√° con multitrainers. En V2 esta constraint deber√° ser `(trainer, starts_at, ends_at)`.
4. **Google Auth** requiere decisi√≥n arquitect√≥nica temprana sobre c√≥mo manejar el merge con cuentas existentes (email ya registrado v√≠a formulario).
5. **Calculadora de √≠ndices** ser√° un m√≥dulo de c√°lculo puro en Python (sin ML). La estructura de datos de `ClientDiagnostic` **no se puede finalizar** hasta recibir la lista de √≠ndices y f√≥rmulas de Germ√°n.
6. **`SessionRating`** debe tener constraint √∫nica `(booking, rater_role)` para evitar calificaciones duplicadas. El trigger puede ser una tarea Huey post-sesi√≥n o un evento post `confirm-attendance`.
7. **Plan semi-personalizado**: la l√≥gica de "qui√©n puede agendar" se implementa como permiso de nivel de suscripci√≥n (`is_group_leader`), no a nivel de rol de usuario, para no contaminar el sistema de roles general.
8. **Servicios Complementarios**: la infraestructura de pagos (Wompi) ya existe. El esfuerzo principal est√° en el modelo de cat√°logo, no en la integraci√≥n de pagos.
9. **Marketplace P√∫blico** queda expl√≠citamente fuera del alcance de V2. Se planificar√° como una iniciativa separada una vez que los Servicios Complementarios est√©n operativos.
